<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discipline Farm - Login</title>
    <style>
        /* --- GLOBAL STYLES --- */
        :root {
            --glass: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.4);
            --primary: #A8C8E8;
            --dark: #7BA3D1;
            --text: #333;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }

        body {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: #87CEEB; /* Default Sky Blue */
            transition: background 1s ease;
        }

        /* --- WEATHER BACKGROUNDS (Dynamic Classes) --- */

        /* SUNNY */
        body.weather-sunny {
            background: linear-gradient(to bottom, #2980b9, #6dd5fa, #ffffff);
        }
        .sun {
            position: absolute; top: 5%; right: 10%; width: 100px; height: 100px;
            background: #ffeb3b; border-radius: 50%;
            box-shadow: 0 0 40px #ffeb3b, 0 0 80px #ff9800;
            animation: pulseSun 4s infinite alternate;
        }
        @keyframes pulseSun { from { transform: scale(1); } to { transform: scale(1.1); } }

        /* RAINY */
        body.weather-rainy {
            background: linear-gradient(to bottom, #203a43, #2c5364);
        }
        .rain-drop {
            position: absolute; background: rgba(255,255,255,0.4);
            width: 2px; height: 15px; top: -20px;
            animation: fall linear infinite;
        }

        /* SNOWY */
        body.weather-snowy {
            background: linear-gradient(to bottom, #83a4d4, #b6fbff);
        }
        .snowflake {
            position: absolute; color: white; top: -20px;
            animation: fall linear infinite; font-size: 1.2rem;
        }

        /* CLOUDY */
        body.weather-cloudy {
            background: linear-gradient(to bottom, #757f9a, #d7dde8);
        }
        .cloud {
            position: absolute; background: #fff; border-radius: 50px;
            opacity: 0.8; animation: moveClouds linear infinite;
        }
        .cloud::after, .cloud::before {
            content:''; position: absolute; background: inherit; border-radius: 50%;
        }
        .cloud::after { width: 50px; height: 50px; top: -25px; left: 25px; }
        .cloud::before { width: 40px; height: 40px; top: -15px; left: 60px; }

        @keyframes fall { to { transform: translateY(110vh); } }
        @keyframes moveClouds { from { left: -200px; } to { left: 110vw; } }

        /* --- UI LAYOUT --- */
        .container {
            width: 90%; max-width: 900px;
            display: flex; gap: 2rem;
            z-index: 10;
        }

        /* Left Panel: Intro */
        .intro-panel {
            flex: 1;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; justify-content: center;
            animation: slideInLeft 0.8s ease;
        }

        /* Right Panel: Login */
        .auth-panel {
            flex: 0.8;
            background: rgba(255,255,255,0.95);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
            height: fit-content;
            animation: slideInRight 0.8s ease;
        }

        @media (max-width: 768px) {
            .container { flex-direction: column; padding: 1rem; overflow-y: auto; height: 100%; }
            .intro-panel { padding: 1.5rem; }
            body { overflow-y: auto; }
        }

        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }

        /* TYPOGRAPHY & FORMS */
        h1 { color: var(--dark); font-size: 2.5rem; margin-bottom: 1rem; }
        h2 { margin-bottom: 1.5rem; color: var(--text); }
        p { margin-bottom: 1rem; line-height: 1.6; color: #555; }

        .mission-box {
            background: rgba(168, 200, 232, 0.1);
            padding: 1rem; border-left: 4px solid var(--primary);
            margin: 1.5rem 0; border-radius: 4px;
        }

        input {
            width: 100%; padding: 12px; margin: 10px 0;
            border: 2px solid #eee; border-radius: 8px;
            font-size: 1rem; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); outline: none; }

        .btn {
            width: 100%; padding: 12px; margin-top: 10px;
            border: none; border-radius: 8px; font-size: 1rem; font-weight: bold;
            cursor: pointer; transition: 0.2s;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--dark); transform: translateY(-2px); }
        .btn-secondary { background: transparent; color: #666; margin-top: 5px; }
        .btn-secondary:hover { text-decoration: underline; }

        .hidden { display: none !important; }

        .weather-info {
            position: absolute; bottom: 20px; right: 20px;
            background: rgba(0,0,0,0.6); color: white;
            padding: 10px 20px; border-radius: 30px; font-size: 0.9rem;
            z-index: 20; display: flex; align-items: center; gap: 10px;
        }

        /* Step List */
        .steps { text-align: left; margin-top: 1rem; }
        .steps li { margin-bottom: 0.5rem; list-style: none; padding-left: 20px; position: relative; }
        .steps li::before { content: 'üå±'; position: absolute; left: 0; }
    </style>
</head>
<body>

    <!-- Weather Effects Container (Populated by JS) -->
    <div id="weather-layer"></div>

    <!-- Weather Info Badge -->
    <div class="weather-info" id="weather-badge">
        <span id="weather-icon">‚òÄÔ∏è</span>
        <span id="weather-text">Loading location...</span>
    </div>

    <!-- Main Content -->
    <div class="container">

        <!-- LEFT: Mission & Intro -->
        <div class="intro-panel">
            <h1>Discipline Farm</h1>
            <p>Turn your focus time into a thriving ecosystem. We combine productivity techniques with the satisfaction of simulation games.</p>

            <div class="mission-box">
                <strong>üéØ The Mission:</strong> To help you build self-discipline by rewarding every minute of focused work with tangible in-game progress.
            </div>

            <h3>How it works:</h3>
            <ul class="steps">
                <li><strong>Focus:</strong> Start the 25-minute timer and study/work.</li>
                <li><strong>Earn:</strong> Complete a session to earn Coins.</li>
                <li><strong>Grow:</strong> Buy seeds and animals. Your farm grows while you rest.</li>
                <li><strong>Track:</strong> Your account saves your stats automatically.</li>
            </ul>
        </div>

        <!-- RIGHT: Auth Form -->
        <div class="auth-panel" id="auth-panel">
            <h2 id="auth-title">Welcome Back</h2>

            <!-- Login Form -->
            <form id="login-form">
                <input type="text" id="login-username" placeholder="Username" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <button type="submit" class="btn btn-primary">Log In</button>
            </form>

            <!-- Signup Form (Hidden initially) -->
            <form id="signup-form" class="hidden">
                <input type="text" id="signup-username" placeholder="Choose Username" required>
                <input type="password" id="signup-password" placeholder="Choose Password" required>
                <input type="password" id="signup-confirm" placeholder="Confirm Password" required>
                <button type="submit" class="btn btn-primary">Create Account</button>
            </form>

            <button class="btn btn-secondary" onclick="toggleAuth()" id="toggle-btn">
                New here? Create an account
            </button>
        </div>

        <!-- Success Message (Hidden initially) -->
        <div class="auth-panel hidden" id="success-panel" style="text-align: center; align-self: center;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üöÄ</div>
            <h2>Ready to Farm!</h2>
            <p>Welcome, <strong id="user-name-display"></strong>.</p>
            <p>Your game data is loaded. The background matches your local weather!</p>
            <br>
            <button class="btn btn-primary" onclick="enterFarm()">Enter Farm</button>
            <br><br>
            <button class="btn btn-secondary" onclick="logout()">Log Out</button>
        </div>

    </div>

    <script>
        /**
         * APP CONTROLLER
         * Handles Weather, Auth, and "Database" simulation
         */
        let currentUser = null;

        function toggleAuth() {
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const toggleBtn = document.getElementById('toggle-btn');
            const title = document.getElementById('auth-title');

            if (loginForm.classList.contains('hidden')) {
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
                title.innerText = "Welcome Back";
                toggleBtn.innerText = "New here? Create an account";
            } else {
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
                title.innerText = "Join the Farm";
                toggleBtn.innerText = "Already have an account? Log In";
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();

            const response = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            const data = await response.json();
            if (data.success) {
                window.location.href = '/game';
            } else {
                alert(data.message);
            }
        }

        async function handleSignup(e) {
            e.preventDefault();
            const username = document.getElementById('signup-username').value.trim();
            const password = document.getElementById('signup-password').value.trim();
            const confirm = document.getElementById('signup-confirm').value.trim();

            if (password !== confirm) return alert("Passwords do not match.");

            const response = await fetch('/api/signup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            const data = await response.json();
            if (data.success) {
                window.location.href = '/game';
            } else {
                alert(data.message);
            }
        }

        function loginSuccess(username) {
            currentUser = username;
            document.getElementById('user-name-display').innerText = username;

            // Switch UI
            document.getElementById('auth-panel').classList.add('hidden');
            document.getElementById('success-panel').classList.remove('hidden');
        }

        function enterFarm() {
            window.location.href = '/game';
        }

        async function logout() {
            await fetch('/api/logout', { method: 'POST' });
            currentUser = null;
            document.getElementById('success-panel').classList.add('hidden');
            document.getElementById('auth-panel').classList.remove('hidden');
            document.getElementById('login-form').reset();
        }

        // --- WEATHER API LOGIC ---

        async function initWeather() {
            try {
                const response = await fetch('/api/weather');
                const data = await response.json();
                if (data.success) {
                    setWeather(data.type, data.city);
                } else {
                    setWeather('sunny', 'Unknown');
                }
            } catch (err) {
                console.error(err);
                setWeather('sunny', 'Unknown');
            }
        }

        function setWeather(type, city) {
            const body = document.body;
            const layer = document.getElementById('weather-layer');
            const iconSpan = document.getElementById('weather-icon');
            const textSpan = document.getElementById('weather-text');

            // Reset
            layer.innerHTML = '';
            body.className = ''; // clear old weather classes

            let icon = '‚òÄÔ∏è';

            if (type === 'sunny') {
                icon = '‚òÄÔ∏è';
                // Add Sun Element
                const sun = document.createElement('div');
                sun.className = 'sun';
                layer.appendChild(sun);
            } else if (type === 'cloudy') {
                icon = '‚òÅÔ∏è';
                // Add Clouds
                for(let i=0; i<5; i++) createCloud(layer);
            } else if (type === 'rainy') {
                icon = 'üåßÔ∏è';
                // Add Rain
                for(let i=0; i<100; i++) createRain(layer);
            } else if (type === 'snowy') {
                icon = '‚ùÑÔ∏è';
                // Add Snow
                for(let i=0; i<50; i++) createSnow(layer);
            }

            // Apply CSS Class
            body.classList.add(`weather-${type}`);
            iconSpan.innerText = icon;
            textSpan.innerText = `${city} - ${type.charAt(0).toUpperCase() + type.slice(1)}`;
        }

        function createRain(container) {
            const drop = document.createElement('div');
            drop.className = 'rain-drop';
            drop.style.left = Math.random() * 100 + 'vw';
            drop.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
            drop.style.animationDelay = Math.random() * 2 + 's';
            container.appendChild(drop);
        }

        function createSnow(container) {
            const flake = document.createElement('div');
            flake.className = 'snowflake';
            flake.innerText = '‚ùÑ';
            flake.style.left = Math.random() * 100 + 'vw';
            flake.style.opacity = Math.random();
            flake.style.fontSize = (Math.random() * 10 + 10) + 'px';
            flake.style.animationDuration = (Math.random() * 3 + 2) + 's';
            flake.style.animationDelay = Math.random() * 2 + 's';
            container.appendChild(flake);
        }

        function createCloud(container) {
            const cloud = document.createElement('div');
            cloud.className = 'cloud';
            const size = Math.random() * 60 + 40;
            cloud.style.width = size * 1.5 + 'px';
            cloud.style.height = size + 'px';
            cloud.style.top = Math.random() * 40 + '%';
            cloud.style.animationDuration = (Math.random() * 20 + 20) + 's';
            cloud.style.opacity = Math.random() * 0.5 + 0.3;
            container.appendChild(cloud);
        }

        // Initialize
        initWeather();

        // Event Listeners
        document.getElementById('login-form').addEventListener('submit', handleLogin);
        document.getElementById('signup-form').addEventListener('submit', handleSignup);

    </script>
</body>
</html>